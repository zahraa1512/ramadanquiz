<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Ù…Ø³Ø§Ø¨Ù‚Ø© Ø±Ù…Ø¶Ø§Ù†</title>
<style>
:root{--bg1:#064e3b;--bg2:#0f766e;--gold:#fbbf24;--card:rgba(255,255,255,.95);}
body{margin:0;font-family:Tahoma,Arial,sans-serif;background:linear-gradient(135deg,var(--bg1),var(--bg2));min-height:100vh;display:flex;align-items:center;justify-content:center}
.stars{position:fixed;inset:0;pointer-events:none;opacity:.25;background-image:radial-gradient(#fff 1px,transparent 1px);background-size:180px 180px}
.card{width:min(980px,94vw);background:var(--card);border-radius:22px;box-shadow:0 14px 40px rgba(0,0,0,.35);padding:16px}
h1{margin:6px 0 2px;text-align:center;color:#064e3b}
.sub{text-align:center;color:#64748b;font-size:14px;margin-bottom:10px}
.grid{display:grid;gap:12px;grid-template-columns:1fr}
@media(min-width:820px){.grid{grid-template-columns:1.2fr .8fr}}
.panel{background:#fff;border:1px solid #e2e8f0;border-radius:16px;padding:14px}
.row{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;align-items:center}
.btn{border:none;border-radius:12px;padding:10px 14px;font-size:16px;cursor:pointer}
.btn.level{background:var(--gold);color:#111827;font-weight:700}
.btn.ghost{background:#e2e8f0;color:#111827}
.btn.secondary{background:#93c5fd;color:#1e3a8a}
.pill{background:rgba(251,191,36,.18);border:1px solid rgba(251,191,36,.35);color:#7c2d12;padding:6px 10px;border-radius:999px;font-size:12px}
.screen{display:none} .screen.active{display:block}
.timer{display:flex;gap:10px;align-items:center;justify-content:space-between;color:#0f172a;margin:6px 0 10px}
.bar{height:10px;background:#e5e7eb;border-radius:999px;overflow:hidden;flex:1}
.bar>div{height:100%;width:100%;background:var(--gold);transition:width .25s linear}
.q{font-size:20px;font-weight:800;color:#064e3b;margin:6px 0 10px}
.opts{display:grid;gap:10px}
.opt{background:#d1fae5;color:#064e3b;border:none;border-radius:14px;padding:12px;font-size:16px;text-align:right;cursor:pointer}
.opt:hover{background:#a7f3d0}
.opt.correct{outline:4px solid rgba(34,197,94,.45)}
.opt.wrong{outline:4px solid rgba(239,68,68,.45);background:#fee2e2}
.note{min-height:22px;color:#334155;font-size:14px;margin-top:8px}
.small{font-size:12px;color:#64748b}
.footerRow{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-top:10px}
input[type=range]{accent-color:#60a5fa}
#confetti{position:fixed;inset:0;pointer-events:none;display:none}
</style>
</head>
<body>
<div class="stars"></div>
<canvas id="confetti"></canvas>

<div class="card">
  <h1>ğŸŒ™âœ¨ Ù…Ø³Ø§Ø¨Ù‚Ø© Ø±Ù…Ø¶Ø§Ù† âœ¨ğŸŒ™</h1>
  <div class="sub">Ù…Ø³ØªÙˆÙŠØ§Øª + ÙˆÙ‚Øª + Ø£ÙØ¶Ù„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ + Ø£Ø³Ø¦Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© â€” ØªØ¹Ù…Ù„ Ø£ÙˆÙÙ„Ø§ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ</div>
  <div class="row" style="margin-bottom:10px">
    <span class="pill" id="pillLevel">Ø§Ù„Ù…Ø³ØªÙˆÙ‰: â€”</span>
    <span class="pill" id="pillQ">Ø§Ù„Ø³Ø¤Ø§Ù„: â€”</span>
    <span class="pill" id="pillScore">Ø§Ù„Ù†ØªÙŠØ¬Ø©: 0</span>
  </div>

  <div class="grid">
    <div class="panel">
      <div id="screenLevel" class="screen active">
        <div class="q" style="text-align:center">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø³ØªÙˆÙ‰</div>
        <div class="row">
          <button class="btn level" id="btnEasy">Ø³Ù‡Ù„</button>
          <button class="btn level" id="btnMed">Ù…ØªÙˆØ³Ø·</button>
          <button class="btn level" id="btnHard">ØµØ¹Ø¨</button>
        </div>
        <p class="small" style="text-align:center;margin-top:10px">
          Ù„ÙƒÙ„ Ø³Ø¤Ø§Ù„: 15 Ø«Ø§Ù†ÙŠØ© â³ â€” Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‡Ø§ÙŠØ© Ø§Ø¶ØºØ· â€œØ£Ø³Ø¦Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©â€ ğŸ”
        </p>
      </div>

      <div id="screenQuiz" class="screen">
        <div class="timer">
          <div><b>â³</b> <span id="time">15</span> Ø«</div>
          <div class="bar"><div id="timeBar"></div></div>
          <div><b>ğŸ“Œ</b> <span id="progress">1</span>/20</div>
        </div>
        <div class="q" id="question">...</div>
        <div class="opts" id="options"></div>
        <div class="note" id="note"></div>
        <div class="footerRow">
          <button class="btn ghost" id="btnSkip">ØªØ®Ø·ÙŠ</button>
          <button class="btn secondary" id="btnRestart">Ø¥Ø¹Ø§Ø¯Ø© Ù…Ù† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©</button>
        </div>
      </div>

      <div id="screenResult" class="screen">
        <div style="text-align:center;font-size:56px">ğŸ‰</div>
        <div class="q" style="text-align:center" id="finalTitle">Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©!</div>
        <div style="text-align:center;font-size:18px;color:#0f172a">
          Ù†ØªÙŠØ¬ØªÙƒ: <b id="finalScore">0</b> / 20
        </div>
        <div class="footerRow">
          <button class="btn level" id="btnNewQ">ğŸ” Ø£Ø³Ø¦Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
          <button class="btn secondary" id="btnBack">â¬…ï¸ ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø³ØªÙˆÙ‰</button>
        </div>
      </div>
    </div>

    <div class="panel">
      <div class="row" style="justify-content:space-between">
        <h3 style="margin:0">ğŸ† Ø£ÙØ¶Ù„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h3>
        <span class="small">ØªÙØ­ÙØ¸ Ø¹Ù„Ù‰ Ù†ÙØ³ Ø§Ù„Ù‡Ø§ØªÙ</span>
      </div>
      <ol id="lbList" style="margin-top:8px"></ol>

      <div class="footerRow">
        <button class="btn ghost" id="btnClearScores">Ù…Ø³Ø­ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
        <button class="btn ghost" id="btnTest">Ø§Ø®ØªØ¨Ø§Ø± Ø£ØµÙˆØ§Øª</button>
        <button class="btn ghost" id="btnMusic">ğŸµ Ù…ÙˆØ³ÙŠÙ‚Ù‰</button>
      </div>
      <div class="row" style="margin-top:8px">
        <span class="pill" style="background:rgba(96,165,250,.18);border-color:rgba(96,165,250,.35);color:#1e3a8a">
          ØµÙˆØª Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰
          <input id="musicVol" type="range" min="0" max="1" step="0.01" value="0.22" style="vertical-align:middle;width:140px">
        </span>
      </div>
      <p class="small" style="margin-top:8px">
        Ù…Ù„Ø§Ø­Ø¸Ø©: Ø¨Ø¹Ø¶ Ø§Ù„Ù‡ÙˆØ§ØªÙ Ù„Ø§ ØªØ³Ù…Ø­ Ø¨Ø§Ù„ØµÙˆØª Ø¥Ù„Ø§ Ø¨Ø¹Ø¯ Ø£ÙˆÙ„ Ù„Ù…Ø³Ø© (Ø²Ø± Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰ ÙŠÙƒÙÙŠ).
      </p>
    </div>
  </div>
</div>

<script>
(function(){
  // ========= Data =========
  const POOL = {"easy": [{"q": "ÙÙŠ Ø£ÙŠ Ø´Ù‡Ø± Ù†ØµÙˆÙ…ØŸ", "opts": ["Ø±Ù…Ø¶Ø§Ù†", "Ù…Ø­Ø±Ù…", "Ø±Ø¬Ø¨", "Ø´Ø¹Ø¨Ø§Ù†"], "a": "Ø±Ù…Ø¶Ø§Ù†"}, {"q": "Ù…ØªÙ‰ ÙŠÙƒÙˆÙ† Ø§Ù„Ø¥ÙØ·Ø§Ø±ØŸ", "opts": ["Ø¹Ù†Ø¯ Ø§Ù„Ù…ØºØ±Ø¨", "Ø¹Ù†Ø¯ Ø§Ù„ÙØ¬Ø±", "Ø¨Ø¹Ø¯ Ø§Ù„Ø¸Ù‡Ø±", "Ù‚Ø¨Ù„ Ø§Ù„Ø³Ø­ÙˆØ±"], "a": "Ø¹Ù†Ø¯ Ø§Ù„Ù…ØºØ±Ø¨"}, {"q": "Ù…Ø§ Ø§Ø³Ù… Ø§Ù„ÙˆØ¬Ø¨Ø© Ù‚Ø¨Ù„ Ø§Ù„ÙØ¬Ø±ØŸ", "opts": ["Ø§Ù„Ø³Ø­ÙˆØ±", "Ø§Ù„Ø¥ÙØ·Ø§Ø±", "Ø§Ù„ØºØ¯Ø§Ø¡", "Ø§Ù„Ø¹Ø´Ø§Ø¡"], "a": "Ø§Ù„Ø³Ø­ÙˆØ±"}, {"q": "Ø¨Ø¹Ø¯ Ø±Ù…Ø¶Ø§Ù† ÙŠØ£ØªÙŠ Ø£ÙŠ Ø¹ÙŠØ¯ØŸ", "opts": ["Ø¹ÙŠØ¯ Ø§Ù„ÙØ·Ø±", "Ø¹ÙŠØ¯ Ø§Ù„Ø£Ø¶Ø­Ù‰", "Ø¹Ø§Ø´ÙˆØ±Ø§Ø¡", "Ø§Ù„Ø£Ø±Ø¨Ø¹ÙŠÙ†"], "a": "Ø¹ÙŠØ¯ Ø§Ù„ÙØ·Ø±"}, {"q": "Ù‡Ù„ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù‚Ø±Ø¢Ù† Ù…Ø³ØªØ­Ø¨Ø© ÙÙŠ Ø±Ù…Ø¶Ø§Ù†ØŸ", "opts": ["Ù†Ø¹Ù…", "Ù„Ø§"], "a": "Ù†Ø¹Ù…"}, {"q": "Ù‡Ù„ Ø§Ù„Ø£ÙƒÙ„ Ø¹Ù…Ø¯Ø§Ù‹ ÙŠØ¨Ø·Ù„ Ø§Ù„ØµÙŠØ§Ù…ØŸ", "opts": ["Ù†Ø¹Ù…", "Ù„Ø§"], "a": "Ù†Ø¹Ù…"}, {"q": "Ù‡Ù„ Ø´Ø±Ø¨ Ø§Ù„Ù…Ø§Ø¡ Ø¹Ù…Ø¯Ø§Ù‹ ÙŠØ¨Ø·Ù„ Ø§Ù„ØµÙŠØ§Ù…ØŸ", "opts": ["Ù†Ø¹Ù…", "Ù„Ø§"], "a": "Ù†Ø¹Ù…"}, {"q": "Ø§Ù„ØµØ¯Ù‚Ø© ÙÙŠ Ø±Ù…Ø¶Ø§Ù†ØŸ", "opts": ["Ù…Ø³ØªØ­Ø¨Ø©", "Ù…ÙƒØ±ÙˆÙ‡Ø©", "Ø­Ø±Ø§Ù…", "Ù„Ø§ Ù‚ÙŠÙ…Ø© Ù„Ù‡Ø§"], "a": "Ù…Ø³ØªØ­Ø¨Ø©"}, {"q": "Ù„ÙŠÙ„Ø© Ø§Ù„Ù‚Ø¯Ø± ØªÙƒÙˆÙ† ÙÙŠ Ø£ÙŠ Ø´Ù‡Ø±ØŸ", "opts": ["Ø±Ù…Ø¶Ø§Ù†", "ØµÙØ±", "Ù…Ø­Ø±Ù…", "Ø¬Ù…Ø§Ø¯Ù‰"], "a": "Ø±Ù…Ø¶Ø§Ù†"}, {"q": "Ù…Ø§ Ø§Ù„Ù‡Ø¯Ù Ù…Ù† Ø§Ù„ØµÙŠØ§Ù…ØŸ", "opts": ["Ø§Ù„ØªÙ‚ÙˆÙ‰", "Ø§Ù„Ù„Ø¹Ø¨", "Ø§Ù„Ø³ÙØ±", "Ø§Ù„ØªØ¬Ø§Ø±Ø©"], "a": "Ø§Ù„ØªÙ‚ÙˆÙ‰"}, {"q": "Ù‡Ù„ Ø§Ù„Ù†ÙˆÙ… ÙˆØ­Ø¯Ù‡ ÙŠØ¨Ø·Ù„ Ø§Ù„ØµÙŠØ§Ù…ØŸ", "opts": ["Ù„Ø§", "Ù†Ø¹Ù…"], "a": "Ù„Ø§"}, {"q": "Ù‡Ù„ Ø§Ù„Ø¯Ø¹Ø§Ø¡ ÙÙŠ Ø±Ù…Ø¶Ø§Ù† Ù…Ø³ØªØ­Ø¨ØŸ", "opts": ["Ù†Ø¹Ù…", "Ù„Ø§"], "a": "Ù†Ø¹Ù…"}, {"q": "Ø²ÙƒØ§Ø© Ø§Ù„ÙØ·Ø±Ø© ØªÙØ®Ø±Ø¬ Ù‚Ø¨Ù„ØŸ", "opts": ["ØµÙ„Ø§Ø© Ø§Ù„Ø¹ÙŠØ¯", "Ø§Ù„Ø³Ø­ÙˆØ±", "Ù„ÙŠÙ„Ø© Ø§Ù„Ù‚Ø¯Ø±", "Ø§Ù„Ø¸Ù‡Ø±"], "a": "ØµÙ„Ø§Ø© Ø§Ù„Ø¹ÙŠØ¯"}, {"q": "Ù‡Ù„ Ø§Ù„ØºÙŠØ¨Ø© Ø£Ù…Ø± Ø­Ø³Ù† ÙÙŠ Ø±Ù…Ø¶Ø§Ù†ØŸ", "opts": ["Ù„Ø§", "Ù†Ø¹Ù…"], "a": "Ù„Ø§"}, {"q": "Ù‡Ù„ Ù†Ù†ÙˆÙŠ Ø§Ù„ØµÙŠØ§Ù… Ù‚Ø¨Ù„ Ø§Ù„ÙØ¬Ø±ØŸ", "opts": ["Ù†Ø¹Ù…", "Ù„Ø§"], "a": "Ù†Ø¹Ù…"}, {"q": "Ù…Ø§ Ø§Ø³Ù… Ø§Ù„ÙˆØ¬Ø¨Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù…ØºØ±Ø¨ØŸ", "opts": ["Ø§Ù„Ø¥ÙØ·Ø§Ø±", "Ø§Ù„Ø³Ø­ÙˆØ±", "Ø§Ù„ÙØ·ÙˆØ± Ø§Ù„ØµØ¨Ø§Ø­ÙŠ", "Ø§Ù„Ø¹Ø´Ø§Ø¡"], "a": "Ø§Ù„Ø¥ÙØ·Ø§Ø±"}, {"q": "ÙƒÙ… Ø¹Ø¯Ø¯ Ø§Ù„ØµÙ„ÙˆØ§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©ØŸ", "opts": ["5", "3", "7", "2"], "a": "5"}, {"q": "Ù‡Ù„ Ø§Ù„Ù‚Ø±Ø¢Ù† Ù†Ø²Ù„ ÙÙŠ Ø±Ù…Ø¶Ø§Ù†ØŸ", "opts": ["Ù†Ø¹Ù…", "Ù„Ø§"], "a": "Ù†Ø¹Ù…"}, {"q": "Ù‡Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…Ø­ØªØ§Ø¬ÙŠÙ† Ø¹Ù…Ù„ Ù…Ø­Ø¨ÙˆØ¨ØŸ", "opts": ["Ù†Ø¹Ù…", "Ù„Ø§"], "a": "Ù†Ø¹Ù…"}, {"q": "Ù‡Ù„ Ø­ÙØ¸ Ø§Ù„Ù„Ø³Ø§Ù† Ù…Ø·Ù„ÙˆØ¨ ÙÙŠ Ø±Ù…Ø¶Ø§Ù†ØŸ", "opts": ["Ù†Ø¹Ù…", "Ù„Ø§"], "a": "Ù†Ø¹Ù…"}], "medium": [{"q": "ÙƒÙ… Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¦Ù…Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø´ÙŠØ¹Ø© Ø§Ù„Ø¥Ù…Ø§Ù…ÙŠØ©ØŸ", "opts": ["12", "10", "14", "4"], "a": "12"}, {"q": "Ù…Ù† Ù‡Ùˆ Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„Ø£ÙˆÙ„ØŸ", "opts": ["Ø§Ù„Ø¥Ù…Ø§Ù… Ø¹Ù„ÙŠ (Ø¹)", "Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„Ø­Ø³Ù† (Ø¹)", "Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„Ø­Ø³ÙŠÙ† (Ø¹)", "Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„ØµØ§Ø¯Ù‚ (Ø¹)"], "a": "Ø§Ù„Ø¥Ù…Ø§Ù… Ø¹Ù„ÙŠ (Ø¹)"}, {"q": "Ù…Ù† Ù‡Ùˆ Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ Ø¹Ø´Ø±ØŸ", "opts": ["Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„Ù…Ù‡Ø¯ÙŠ (Ø¹Ø¬)", "Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„Ø±Ø¶Ø§ (Ø¹)", "Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„ÙƒØ§Ø¸Ù… (Ø¹)", "Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„Ø¬ÙˆØ§Ø¯ (Ø¹)"], "a": "Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„Ù…Ù‡Ø¯ÙŠ (Ø¹Ø¬)"}, {"q": "Ø£ÙŠ Ø¥Ù…Ø§Ù… ÙˆÙÙ„Ø¯ ÙÙŠ 15 Ø±Ù…Ø¶Ø§Ù†ØŸ", "opts": ["Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„Ø­Ø³Ù† (Ø¹)", "Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„Ø­Ø³ÙŠÙ† (Ø¹)", "Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„Ø³Ø¬Ø§Ø¯ (Ø¹)", "Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„Ø¨Ø§Ù‚Ø± (Ø¹)"], "a": "Ø§Ù„Ø¥Ù…Ø§Ù… Ø§Ù„Ø­Ø³Ù† (Ø¹)"}, {"q": "ÙÙŠ Ø£ÙŠ ÙŠÙˆÙ… Ø¶ÙØ±Ø¨ Ø§Ù„Ø¥Ù…Ø§Ù… Ø¹Ù„ÙŠ (Ø¹)ØŸ", "opts": ["19 Ø±Ù…Ø¶Ø§Ù†", "21 Ø±Ù…Ø¶Ø§Ù†", "15 Ø´Ø¹Ø¨Ø§Ù†", "10 Ù…Ø­Ø±Ù…"], "a": "19 Ø±Ù…Ø¶Ø§Ù†"}, {"q": "ÙÙŠ Ø£ÙŠ ÙŠÙˆÙ… Ø§Ø³ØªØ´Ù‡Ø¯ Ø§Ù„Ø¥Ù…Ø§Ù… Ø¹Ù„ÙŠ (Ø¹)ØŸ", "opts": ["21 Ø±Ù…Ø¶Ø§Ù†", "19 Ø±Ù…Ø¶Ø§Ù†", "23 Ø±Ù…Ø¶Ø§Ù†", "1 Ø´ÙˆØ§Ù„"], "a": "21 Ø±Ù…Ø¶Ø§Ù†"}, {"q": "Ù…Ù† Ù‚Ø§ØªÙ„ Ø§Ù„Ø¥Ù…Ø§Ù… Ø¹Ù„ÙŠ (Ø¹) Ø¨Ø¶Ø±Ø¨Ø© Ø§Ù„ØºØ¯Ø±ØŸ", "opts": ["Ø§Ø¨Ù† Ù…Ù„Ø¬Ù…", "ÙŠØ²ÙŠØ¯", "Ø´Ù…Ø±", "Ø§Ø¨Ù† Ø³Ø¹Ø¯"], "a": "Ø§Ø¨Ù† Ù…Ù„Ø¬Ù…"}, {"q": "Ø£Ø´Ù‡Ø± Ù„ÙŠØ§Ù„ÙŠ Ø§Ù„Ù‚Ø¯Ø± Ø§Ù„ØªÙŠ ØªÙØ­ÙŠÙ‰ Ø¹Ù†Ø¯ Ø§Ù„Ø´ÙŠØ¹Ø© Ù‡ÙŠ:", "opts": ["19 Ùˆ21 Ùˆ23", "27 ÙÙ‚Ø·", "10 Ùˆ11 Ùˆ12", "1 Ùˆ2 Ùˆ3"], "a": "19 Ùˆ21 Ùˆ23"}, {"q": "Ø£ÙŠ Ø³ÙˆØ±Ø© ÙŠÙƒØ«Ø± Ø°ÙƒØ±Ù‡Ø§ ÙÙŠ Ù„ÙŠØ§Ù„ÙŠ Ø§Ù„Ù‚Ø¯Ø±ØŸ", "opts": ["Ø³ÙˆØ±Ø© Ø§Ù„Ù‚Ø¯Ø±", "Ø³ÙˆØ±Ø© Ø§Ù„ÙÙŠÙ„", "Ø³ÙˆØ±Ø© Ø§Ù„ØªÙƒØ§Ø«Ø±", "Ø³ÙˆØ±Ø© Ø§Ù„Ù…Ø³Ø¯"], "a": "Ø³ÙˆØ±Ø© Ø§Ù„Ù‚Ø¯Ø±"}, {"q": "Ø¥Ø®Ø±Ø§Ø¬ Ø²ÙƒØ§Ø© Ø§Ù„ÙØ·Ø±Ø© Ø­ÙƒÙ…Ù‡:", "opts": ["ÙˆØ§Ø¬Ø¨", "Ù…Ø³ØªØ­Ø¨", "Ù…ÙƒØ±ÙˆÙ‡", "Ù…Ø¨Ø§Ø­"], "a": "ÙˆØ§Ø¬Ø¨"}, {"q": "Ø£ÙØ¶Ù„ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ ÙÙŠ Ù„ÙŠÙ„Ø© Ø§Ù„Ù‚Ø¯Ø±:", "opts": ["Ø§Ù„Ø¯Ø¹Ø§Ø¡ ÙˆØ§Ù„Ø§Ø³ØªØºÙØ§Ø±", "Ø§Ù„Ù†ÙˆÙ… ÙÙ‚Ø·", "Ø§Ù„Ø¬Ø¯Ø§Ù„", "Ø¥Ø¶Ø§Ø¹Ø© Ø§Ù„ÙˆÙ‚Øª"], "a": "Ø§Ù„Ø¯Ø¹Ø§Ø¡ ÙˆØ§Ù„Ø§Ø³ØªØºÙØ§Ø±"}, {"q": "Ù…Ù† Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª Ø§Ù„Ù…Ù‡Ù…Ø© ÙÙŠ Ø±Ù…Ø¶Ø§Ù†:", "opts": ["Ø§Ø³ØªØ´Ù‡Ø§Ø¯ Ø§Ù„Ø¥Ù…Ø§Ù… Ø¹Ù„ÙŠ (Ø¹)", "Ø¹Ø§Ø´ÙˆØ±Ø§Ø¡", "Ø§Ù„Ø£Ø±Ø¨Ø¹ÙŠÙ†", "Ø§Ù„ØºØ¯ÙŠØ±"], "a": "Ø§Ø³ØªØ´Ù‡Ø§Ø¯ Ø§Ù„Ø¥Ù…Ø§Ù… Ø¹Ù„ÙŠ (Ø¹)"}, {"q": "Ø§Ù„ØµÙˆÙ… Ø§Ù„ÙˆØ§Ø¬Ø¨ ÙÙŠ Ø±Ù…Ø¶Ø§Ù† ÙŠÙƒÙˆÙ† Ø¹Ù„Ù‰:", "opts": ["Ø§Ù„Ù…ÙƒÙ„Ù‘Ù Ø§Ù„Ù‚Ø§Ø¯Ø±", "ÙƒÙ„ Ø§Ù„Ø£Ø·ÙØ§Ù„", "ÙÙ‚Ø· Ø§Ù„Ù…Ø³Ø§ÙØ±", "ÙÙ‚Ø· Ø§Ù„ÙÙ‚ÙŠØ±"], "a": "Ø§Ù„Ù…ÙƒÙ„Ù‘Ù Ø§Ù„Ù‚Ø§Ø¯Ø±"}, {"q": "Ø§Ù„Ø¥ÙØ·Ø§Ø± Ø¹Ù…Ø¯Ø§Ù‹ ÙÙŠ Ø±Ù…Ø¶Ø§Ù† Ø¨Ø¯ÙˆÙ† Ø¹Ø°Ø±:", "opts": ["Ø°Ù†Ø¨ ÙƒØ¨ÙŠØ±", "Ù…Ø¨Ø§Ø­", "Ù…Ø³ØªØ­Ø¨", "Ù„Ø§ Ø´ÙŠØ¡"], "a": "Ø°Ù†Ø¨ ÙƒØ¨ÙŠØ±"}, {"q": "ÙŠÙØ³ØªØ­Ø¨ ØªØ¹Ø¬ÙŠÙ„ Ø§Ù„Ø¥ÙØ·Ø§Ø± Ø¨Ø¹Ø¯:", "opts": ["ØªØ­Ù‚Ù‚ Ø§Ù„ØºØ±ÙˆØ¨", "Ù…Ù†ØªØµÙ Ø§Ù„Ù„ÙŠÙ„", "Ø¨Ø¹Ø¯ Ø§Ù„Ø¹Ø´Ø§Ø¡", "Ø¨Ø¹Ø¯ Ø§Ù„Ø³Ø­ÙˆØ±"], "a": "ØªØ­Ù‚Ù‚ Ø§Ù„ØºØ±ÙˆØ¨"}, {"q": "Ù…Ù† Ø¢Ø¯Ø§Ø¨ Ø±Ù…Ø¶Ø§Ù†:", "opts": ["Ø­Ø³Ù† Ø§Ù„Ø®Ù„Ù‚", "ÙƒØ«Ø±Ø© Ø§Ù„Ø³Ø¨", "Ø§Ù„Ø§Ø³ØªÙ‡Ø²Ø§Ø¡", "Ù‚Ø·Ø¹ Ø§Ù„Ø±Ø­Ù…"], "a": "Ø­Ø³Ù† Ø§Ù„Ø®Ù„Ù‚"}, {"q": "Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù‚Ø±Ø¢Ù† ÙÙŠ Ø±Ù…Ø¶Ø§Ù†:", "opts": ["Ù…Ø³ØªØ­Ø¨Ø© Ø¬Ø¯Ø§Ù‹", "Ù…ÙƒØ±ÙˆÙ‡Ø©", "Ø­Ø±Ø§Ù…", "Ù„Ø§ Ø¹Ù„Ø§Ù‚Ø©"], "a": "Ù…Ø³ØªØ­Ø¨Ø© Ø¬Ø¯Ø§Ù‹"}, {"q": "ØªØ¹Ù…Ø¯ Ø§Ù„Ø£ÙƒÙ„ ÙˆØ§Ù„Ø´Ø±Ø¨:", "opts": ["ÙŠØ¨Ø·Ù„ Ø§Ù„ØµÙˆÙ…", "Ù„Ø§ ÙŠØ¤Ø«Ø±", "ÙŠØ²ÙŠØ¯ Ø§Ù„Ø£Ø¬Ø±", "ÙŠØ³ØªØ­Ø¨"], "a": "ÙŠØ¨Ø·Ù„ Ø§Ù„ØµÙˆÙ…"}, {"q": "Ù…Ù† Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ù…Ø³ØªØ­Ø¨Ø© ÙÙŠ Ø±Ù…Ø¶Ø§Ù†:", "opts": ["Ø§Ù„ØµØ¯Ù‚Ø©", "Ø§Ù„ØºÙŠØ¨Ø©", "Ø§Ù„Ø®ØµØ§Ù…", "Ø¥ÙŠØ°Ø§Ø¡ Ø§Ù„Ù†Ø§Ø³"], "a": "Ø§Ù„ØµØ¯Ù‚Ø©"}, {"q": "Ø³ÙÙ…Ù‘ÙŠ Ø±Ù…Ø¶Ø§Ù† Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù… Ù„Ø£Ù†Ù‡:", "opts": ["ÙŠØ­Ø±Ù‚ Ø§Ù„Ø°Ù†ÙˆØ¨", "Ø´Ù‡Ø± ØªØ¬Ø§Ø±Ø©", "Ø´Ù‡Ø± Ø³ÙØ±", "Ø´Ù‡Ø± Ù„Ø¹Ø¨"], "a": "ÙŠØ­Ø±Ù‚ Ø§Ù„Ø°Ù†ÙˆØ¨"}], "hard": [{"q": "ØªÙØ¹Ø¯ Ù„ÙŠÙ„Ø© Ø§Ù„Ù‚Ø¯Ø±:", "opts": ["Ø®ÙŠØ± Ù…Ù† Ø£Ù„Ù Ø´Ù‡Ø±", "Ù…Ø«Ù„ Ø£ÙŠ Ù„ÙŠÙ„Ø©", "Ø£Ù‚Ù„ Ù…Ù† ØºÙŠØ±Ù‡Ø§", "Ù„ÙŠÙ„Ø© Ø§Ù„Ø¹ÙŠØ¯ ÙÙ‚Ø·"], "a": "Ø®ÙŠØ± Ù…Ù† Ø£Ù„Ù Ø´Ù‡Ø±"}, {"q": "Ù…Ù† Ø£Ø´Ù‡Ø± Ø£Ø¹Ù…Ø§Ù„ Ù„ÙŠØ§Ù„ÙŠ Ø§Ù„Ù‚Ø¯Ø±:", "opts": ["Ø§Ù„ØºÙØ³Ù„ + Ø§Ù„Ø¯Ø¹Ø§Ø¡ + Ø§Ù„Ù‚Ø±Ø¢Ù†", "Ø§Ù„Ø³ÙØ±", "Ø§Ù„Ù„Ù‡Ùˆ", "ØªØ±Ùƒ Ø§Ù„ØµÙ„Ø§Ø©"], "a": "Ø§Ù„ØºÙØ³Ù„ + Ø§Ù„Ø¯Ø¹Ø§Ø¡ + Ø§Ù„Ù‚Ø±Ø¢Ù†"}, {"q": "Ø§Ù„Ø³Ù‡Ø± Ù„Ù„Ø¹Ø¨Ø§Ø¯Ø© ÙÙŠ Ù„ÙŠØ§Ù„ÙŠ Ø§Ù„Ù‚Ø¯Ø±:", "opts": ["Ù…Ø³ØªØ­Ø¨", "Ù…ÙƒØ±ÙˆÙ‡", "Ù…Ø­Ø±Ù…", "Ù„Ø§ Ù…Ø¹Ù†Ù‰"], "a": "Ù…Ø³ØªØ­Ø¨"}, {"q": "Ù…Ù† Ù…Ø¹Ø§Ù†ÙŠ Ø§Ù„ØªÙ‚ÙˆÙ‰:", "opts": ["Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù„Ù‡ ÙˆØªØ±Ùƒ Ø§Ù„Ù…Ø¹ØµÙŠØ©", "ÙƒØ«Ø±Ø© Ø§Ù„Ø£ÙƒÙ„", "Ø§Ù„ØºØ¶Ø¨", "Ø§Ù„ØªÙƒØ¨Ø±"], "a": "Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù„Ù‡ ÙˆØªØ±Ùƒ Ø§Ù„Ù…Ø¹ØµÙŠØ©"}, {"q": "Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„ØªÙŠ ØªÙÙ†Ù‚Øµ Ø£Ø¬Ø± Ø§Ù„ØµØ§Ø¦Ù…:", "opts": ["Ø§Ù„ØºÙŠØ¨Ø© ÙˆØ§Ù„Ù†Ù…ÙŠÙ…Ø©", "Ø§Ù„ØµØ¯Ù‚Ø©", "Ø§Ù„ØµÙ„Ø§Ø©", "Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù‚Ø±Ø¢Ù†"], "a": "Ø§Ù„ØºÙŠØ¨Ø© ÙˆØ§Ù„Ù†Ù…ÙŠÙ…Ø©"}, {"q": "Ù…Ù† ØµÙØ§Øª Ø§Ù„Ù…Ø¤Ù…Ù† ÙÙŠ Ø±Ù…Ø¶Ø§Ù†:", "opts": ["Ø§Ù„ØµØ¨Ø±", "Ø§Ù„ØªÙ‡ÙˆØ±", "Ø§Ù„Ø¸Ù„Ù…", "Ø§Ù„Ø¥ÙŠØ°Ø§Ø¡"], "a": "Ø§Ù„ØµØ¨Ø±"}, {"q": "Ø§Ù„Ù…Ø¯Ø§ÙˆÙ…Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø±Ø¢Ù† ÙÙŠ Ø±Ù…Ø¶Ø§Ù†:", "opts": ["Ø²ÙŠØ§Ø¯Ø© Ù†ÙˆØ± Ø§Ù„Ù‚Ù„Ø¨", "ØªØ¹Ø¨ Ø¨Ù„Ø§ ÙØ§Ø¦Ø¯Ø©", "Ø­Ø±Ø§Ù…", "Ù…ÙƒØ±ÙˆÙ‡"], "a": "Ø²ÙŠØ§Ø¯Ø© Ù†ÙˆØ± Ø§Ù„Ù‚Ù„Ø¨"}, {"q": "Ù…Ù† Ø£ÙØ¶Ù„ Ù…Ø§ ÙŠÙÙ‚Ø§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ø¥ÙØ·Ø§Ø±:", "opts": ["Ø¯Ø¹Ø§Ø¡ ÙˆØ´ÙƒØ± Ø§Ù„Ù„Ù‡", "Ø³Ø®Ø±ÙŠØ©", "Ø³Ø¨", "Ø¬Ø¯Ø§Ù„"], "a": "Ø¯Ø¹Ø§Ø¡ ÙˆØ´ÙƒØ± Ø§Ù„Ù„Ù‡"}, {"q": "Ù…Ù† Ø«Ù…Ø±Ø§Øª Ø§Ù„ØµÙŠØ§Ù…:", "opts": ["ØªÙ‚ÙˆÙŠØ© Ø§Ù„Ø¥Ø±Ø§Ø¯Ø©", "Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø¹Ø§ØµÙŠ", "Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¸Ù„Ù…", "Ù‚Ø·Ø¹ Ø§Ù„ØµÙ„Ø§Ø©"], "a": "ØªÙ‚ÙˆÙŠØ© Ø§Ù„Ø¥Ø±Ø§Ø¯Ø©"}, {"q": "ØµÙ„Ø© Ø§Ù„Ø±Ø­Ù… ÙÙŠ Ø±Ù…Ø¶Ø§Ù†:", "opts": ["Ù…Ø³ØªØ­Ø¨Ø© Ø¬Ø¯Ø§Ù‹", "Ù…ÙƒØ±ÙˆÙ‡Ø©", "Ù…Ø­Ø±Ù…Ø©", "Ù„Ø§ Ø¹Ù„Ø§Ù‚Ø©"], "a": "Ù…Ø³ØªØ­Ø¨Ø© Ø¬Ø¯Ø§Ù‹"}, {"q": "Ø§Ù„ØµØ¯Ù‚Ø© ÙÙŠ Ø±Ù…Ø¶Ø§Ù† ØªÙØ¹Ø¯:", "opts": ["Ø¨Ø§Ø¨Ø§Ù‹ Ù„Ù„Ø±Ø­Ù…Ø©", "Ø¹Ù…Ù„Ø§Ù‹ Ù…ÙƒØ±ÙˆÙ‡Ø§Ù‹", "Ø°Ù†Ø¨Ø§Ù‹", "Ø¨Ø¯Ø¹Ø©"], "a": "Ø¨Ø§Ø¨Ø§Ù‹ Ù„Ù„Ø±Ø­Ù…Ø©"}, {"q": "Ø§Ù„Ø§Ø³ØªØºÙØ§Ø± ÙÙŠ Ø±Ù…Ø¶Ø§Ù†:", "opts": ["Ù…Ø³ØªØ­Ø¨ ÙƒØ«ÙŠØ±Ø§Ù‹", "ØºÙŠØ± Ù…Ø·Ù„ÙˆØ¨", "Ø­Ø±Ø§Ù…", "Ù…ÙƒØ±ÙˆÙ‡"], "a": "Ù…Ø³ØªØ­Ø¨ ÙƒØ«ÙŠØ±Ø§Ù‹"}, {"q": "Ø§Ù„Ø¥Ø­Ø³Ø§Ù† Ù„Ù„Ù†Ø§Ø³ ÙÙŠ Ø±Ù…Ø¶Ø§Ù†:", "opts": ["ÙŠØ²ÙŠØ¯ Ø§Ù„Ø£Ø¬Ø±", "ÙŠÙ†Ù‚Øµ Ø§Ù„Ø£Ø¬Ø±", "Ù„Ø§ ÙØ§Ø¦Ø¯Ø©", "Ø­Ø±Ø§Ù…"], "a": "ÙŠØ²ÙŠØ¯ Ø§Ù„Ø£Ø¬Ø±"}, {"q": "Ø­ÙØ¸ Ø§Ù„Ù„Ø³Ø§Ù† ÙÙŠ Ø±Ù…Ø¶Ø§Ù† ÙŠØ¹Ù†ÙŠ:", "opts": ["ØªØ±Ùƒ Ø§Ù„Ø³Ø¨ ÙˆØ§Ù„ØºÙŠØ¨Ø©", "ØªØ±Ùƒ Ø§Ù„Ø·Ø¹Ø§Ù…", "ØªØ±Ùƒ Ø§Ù„Ù†ÙˆÙ…", "ØªØ±Ùƒ Ø§Ù„Ø¯Ø±Ø§Ø³Ø©"], "a": "ØªØ±Ùƒ Ø§Ù„Ø³Ø¨ ÙˆØ§Ù„ØºÙŠØ¨Ø©"}, {"q": "Ø§Ù„ØªÙˆØ§Ø¶Ø¹ ÙÙŠ Ø±Ù…Ø¶Ø§Ù†:", "opts": ["Ø®Ù„Ù‚ Ù…Ø·Ù„ÙˆØ¨", "Ø¶Ø¹Ù", "Ø­Ø±Ø§Ù…", "Ù…ÙƒØ±ÙˆÙ‡"], "a": "Ø®Ù„Ù‚ Ù…Ø·Ù„ÙˆØ¨"}, {"q": "Ù…Ù† Ø£ÙØ¶Ù„ Ø§Ù„Ù„ÙŠØ§Ù„ÙŠ ÙÙŠ Ø§Ù„Ø³Ù†Ø©:", "opts": ["Ù„ÙŠØ§Ù„ÙŠ Ø§Ù„Ù‚Ø¯Ø±", "ÙƒÙ„ Ø§Ù„Ù„ÙŠØ§Ù„ÙŠ Ø³ÙˆØ§Ø¡", "Ù„ÙŠÙ„Ø© Ø§Ù„Ø³ÙØ±", "Ù„ÙŠÙ„Ø© Ø§Ù„Ø¹ÙŠØ¯ ÙÙ‚Ø·"], "a": "Ù„ÙŠØ§Ù„ÙŠ Ø§Ù„Ù‚Ø¯Ø±"}, {"q": "Ø§Ø­ØªØ±Ø§Ù… Ø±Ù…Ø¶Ø§Ù† ÙŠØ´Ù…Ù„:", "opts": ["ØªØ±Ùƒ Ø§Ù„Ù…Ø­Ø±Ù…Ø§Øª ÙˆØ§Ù„Ø®ØµØ§Ù…", "Ø§Ù„Ø¥Ø³Ø±Ø§Ù", "Ø§Ù„Ø£Ø°Ù‰", "Ø§Ù„ØºÙŠØ¨Ø©"], "a": "ØªØ±Ùƒ Ø§Ù„Ù…Ø­Ø±Ù…Ø§Øª ÙˆØ§Ù„Ø®ØµØ§Ù…"}, {"q": "ØµÙ„Ø§Ø© Ø§Ù„Ù„ÙŠÙ„ ÙÙŠ Ø±Ù…Ø¶Ø§Ù†:", "opts": ["Ù…Ø³ØªØ­Ø¨Ø© Ø¬Ø¯Ø§Ù‹", "ÙˆØ§Ø¬Ø¨Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù…ÙŠØ¹", "Ù…Ø­Ø±Ù…Ø©", "Ù„Ø§ ØªÙØ´Ø±Ø¹"], "a": "Ù…Ø³ØªØ­Ø¨Ø© Ø¬Ø¯Ø§Ù‹"}, {"q": "Ù…Ù† Ø¢Ø¯Ø§Ø¨ Ø§Ù„Ø³Ø­ÙˆØ±:", "opts": ["Ø§Ù„ØªØ¨ÙƒÙŠØ± ÙˆØ§Ù„Ù†ÙŠØ©", "ØªØ±Ùƒ Ø§Ù„Ù†ÙŠØ©", "Ø§Ù„Ø£ÙƒÙ„ Ø¨Ù„Ø§ Ø­Ø¯ÙˆØ¯", "Ø¥ÙŠØ°Ø§Ø¡ Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†"], "a": "Ø§Ù„ØªØ¨ÙƒÙŠØ± ÙˆØ§Ù„Ù†ÙŠØ©"}, {"q": "Ù…Ù† Ø£Ø¹Ù…Ø§Ù„ Ù„ÙŠÙ„Ø© Ø§Ù„Ù‚Ø¯Ø±:", "opts": ["Ø§Ù„Ø¯Ø¹Ø§Ø¡ ÙˆØ§Ù„Ø§Ø³ØªØºÙØ§Ø±", "Ø§Ù„Ù„Ù‡Ùˆ", "Ø§Ù„Ù†ÙˆÙ… ÙÙ‚Ø·", "Ø§Ù„Ø®ØµØ§Ù…"], "a": "Ø§Ù„Ø¯Ø¹Ø§Ø¡ ÙˆØ§Ù„Ø§Ø³ØªØºÙØ§Ø±"}]};
  const Q_PER_ROUND = 20;
  const SECONDS_PER_Q = 15;

  // ========= State =========
  let level = null;
  let round = [];
  let idx = 0;
  let score = 0;
  let locked = false;
  let timerId = null;
  let timeLeft = SECONDS_PER_Q;

  // ========= Helpers =========
  const $ = (id)=>document.getElementById(id);
  function show(id){
    ["screenLevel","screenQuiz","screenResult"].forEach(s=>$(s).classList.remove("active"));
    $(id).classList.add("active");
  }
  function labelLevel(lv){ return lv==="easy"?"Ø³Ù‡Ù„":lv==="medium"?"Ù…ØªÙˆØ³Ø·":"ØµØ¹Ø¨"; }
  function shuffle(a){
    const x=a.slice();
    for(let i=x.length-1;i>0;i--){
      const j=Math.floor(Math.random()*(i+1));
      [x[i],x[j]]=[x[j],x[i]];
    }
    return x;
  }
  function updatePills(){
    $("pillLevel").textContent = "Ø§Ù„Ù…Ø³ØªÙˆÙ‰: " + (level?labelLevel(level):"â€”");
    $("pillQ").textContent = "Ø§Ù„Ø³Ø¤Ø§Ù„: " + (level?`${Math.min(idx+1,Q_PER_ROUND)}/${Q_PER_ROUND}`:"â€”");
    $("pillScore").textContent = "Ø§Ù„Ù†ØªÙŠØ¬Ø©: " + score;
  }
  function stopTimer(){ if(timerId){clearInterval(timerId);timerId=null;} }
  function startTimer(){
    stopTimer();
    timeLeft = SECONDS_PER_Q;
    $("time").textContent = timeLeft;
    $("timeBar").style.width = "100%";
    timerId = setInterval(()=>{
      timeLeft--;
      $("time").textContent = timeLeft;
      $("timeBar").style.width = `${(timeLeft/SECONDS_PER_Q)*100}%`;
      if(timeLeft<=0){
        stopTimer();
        locked = true;
        $("note").textContent = "â³ Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª. Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©: " + round[idx].a;
        setTimeout(next, 900);
      }
    }, 1000);
  }

  // ========= Sounds (safe) =========
  function safeAudioCtx(){ return window.AudioContext || window.webkitAudioContext; }
  function beep(kind){
    try{
      const AC = safeAudioCtx(); if(!AC) return;
      const ctx = new AC();
      const now = ctx.currentTime;

      function tone(freq, dur, gain, type){
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.type = type||"triangle";
        o.frequency.setValueAtTime(freq, now);
        g.gain.setValueAtTime(0.0001, now);
        g.gain.linearRampToValueAtTime(gain, now+0.01);
        g.gain.exponentialRampToValueAtTime(0.0001, now+dur);
        o.connect(g); g.connect(ctx.destination);
        o.start(now); o.stop(now+dur+0.02);
      }

      if(kind==="ok"){ tone(880,.18,.6,"triangle"); setTimeout(()=>tone(1175,.18,.6,"triangle"),120); }
      else if(kind==="bad"){ tone(220,.28,.55,"sawtooth"); }
      else if(kind==="win"){
        // Ù‚ÙˆÙŠ Ù„ÙƒÙ† Ø«Ø§Ø¨Øª
        tone(988,.22,.7,"triangle");
        setTimeout(()=>tone(1319,.22,.65,"triangle"),120);
        setTimeout(()=>tone(1568,.22,.6,"triangle"),240);
      }
    }catch(e){}
  }
  function testSounds(){ beep("ok"); setTimeout(()=>beep("bad"),450); }

  // ========= Music (energetic + chill) =========
  let musicCtx=null, musicGain=null, musicOn=false, musicTimer=null, step=0;
  const NOTES = [392.00,440.00,493.88,587.33,523.25,493.88,440.00,392.00]; // G A B D C B A G
  function ensureMusic(){
    const AC = safeAudioCtx(); if(!AC) return false;
    if(musicCtx) return true;
    musicCtx = new AC();
    musicGain = musicCtx.createGain();
    musicGain.gain.value = parseFloat($("musicVol").value||"0.22");

    const lp = musicCtx.createBiquadFilter();
    lp.type="lowpass"; lp.frequency.value=1500;
    musicGain.connect(lp);
    lp.connect(musicCtx.destination);
    return true;
  }
  function musicTick(){
    if(!musicOn || !musicCtx) return;
    const now = musicCtx.currentTime;
    const freq = NOTES[step % NOTES.length];
    step++;

    // melody
    const o = musicCtx.createOscillator();
    const g = musicCtx.createGain();
    o.type="sine";
    o.frequency.setValueAtTime(freq, now);
    g.gain.setValueAtTime(0.0001, now);
    g.gain.linearRampToValueAtTime(0.22, now+0.01);
    g.gain.exponentialRampToValueAtTime(0.0001, now+0.35);
    o.connect(g); g.connect(musicGain);
    o.start(now); o.stop(now+0.36);

    // beat click
    const c = musicCtx.createOscillator();
    const cg = musicCtx.createGain();
    c.type="square";
    c.frequency.setValueAtTime(180, now);
    cg.gain.setValueAtTime(0.0001, now);
    cg.gain.linearRampToValueAtTime(0.16, now+0.003);
    cg.gain.exponentialRampToValueAtTime(0.0001, now+0.06);
    c.connect(cg); cg.connect(musicGain);
    c.start(now); c.stop(now+0.07);

    // bass pulse
    const b = musicCtx.createOscillator();
    const bg = musicCtx.createGain();
    b.type="sine";
    b.frequency.setValueAtTime(freq/2, now);
    bg.gain.setValueAtTime(0.0001, now);
    bg.gain.linearRampToValueAtTime(0.18, now+0.01);
    bg.gain.exponentialRampToValueAtTime(0.0001, now+0.18);
    b.connect(bg); bg.connect(musicGain);
    b.start(now); b.stop(now+0.19);
  }
  function startMusic(){
    if(!ensureMusic()) return;
    musicOn=true;
    $("btnMusic").textContent="ğŸµ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰";
    if(musicTimer) clearInterval(musicTimer);
    musicTick();
    musicTimer=setInterval(musicTick, 320);
  }
  function stopMusic(){
    musicOn=false;
    $("btnMusic").textContent="ğŸµ Ù…ÙˆØ³ÙŠÙ‚Ù‰";
    if(musicTimer){clearInterval(musicTimer); musicTimer=null;}
  }
  function toggleMusic(){
    // this counts as user gesture
    if(!musicOn) startMusic(); else stopMusic();
  }

  // ========= Game =========
  function buildRound(){
    const pool = POOL[level] || [];
    const selected = shuffle(pool).slice(0, Q_PER_ROUND);
    // Shuffle options per question so correct isn't always first
    round = selected.map(q=>({q:q.q, a:q.a, opts: shuffle(q.opts)}));
    idx=0; score=0; locked=false;
    updatePills();
  }

  function loadQuestion(){
    locked=false;
    updatePills();
    $("note").textContent="";
    $("progress").textContent = (idx+1);
    const q = round[idx];
    $("question").textContent = q.q;

    const wrap = $("options");
    wrap.innerHTML="";
    q.opts.forEach(opt=>{
      const b=document.createElement("button");
      b.className="opt";
      b.textContent=opt;
      b.addEventListener("click", ()=>choose(opt,b));
      wrap.appendChild(b);
    });
    startTimer();
  }

  function choose(opt, btn){
    if(locked) return;
    locked=true;
    stopTimer();
    const q=round[idx];
    const all=[...$("options").children];
    if(opt===q.a){
      score++;
      btn.classList.add("correct");
      beep("ok");
      $("note").textContent="âœ… ØµØ­ÙŠØ­!";
      updatePills();
      setTimeout(next, 650);
    } else {
      btn.classList.add("wrong");
      all.forEach(x=>{ if(x.textContent===q.a) x.classList.add("correct"); });
      beep("bad");
      $("note").textContent="âŒ Ø®Ø·Ø£. Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©: " + q.a;
      setTimeout(next, 950);
    }
  }

  function next(){
    idx++;
    if(idx<Q_PER_ROUND) loadQuestion();
    else finish();
  }

  function finish(){
    stopTimer();
    show("screenResult");
    stopMusic();
    $("finalScore").textContent=score;
    if(score>=16){
      $("finalTitle").textContent="Ù…Ù…ØªØ§Ø²! ğŸ‰";
      beep("win");
      confettiBurst();
    } else if(score < 10) {
      $("finalTitle").textContent="Ù„Ù„Ø£Ø³Ù Ø±Ø§Ø³Ø¨ ğŸ˜” â€” Ù‚ÙˆÙ‘ÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ";
    } else {
      $("finalTitle").textContent="Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©!";
    }
saveScore();
    renderLeaderboard();
    updatePills();
  }

  // ========= Leaderboard =========
  function key(){ return "ramadan_scores_" + level; }
  function saveScore(){
    try{
      const k=key();
      const list = JSON.parse(localStorage.getItem(k) || "[]");
      list.push({score:score, at:new Date().toISOString()});
      list.sort((a,b)=>b.score-a.score);
      localStorage.setItem(k, JSON.stringify(list.slice(0,10)));
    }catch(e){}
  }
  function renderLeaderboard(){
    const lb=$("lbList");
    lb.innerHTML="";
    if(!level){ lb.innerHTML="<li>Ø§Ø®ØªØ± Ù…Ø³ØªÙˆÙ‰ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬.</li>"; return; }
    let list=[];
    try{ list=JSON.parse(localStorage.getItem(key()) || "[]"); }catch(e){}
    if(!list.length){ lb.innerHTML="<li>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ø¨Ø¹Ø¯.</li>"; return; }
    list.forEach((x,i)=>{
      const li=document.createElement("li");
      li.textContent = `${x.score}/20 â€” ${labelLevel(level)} â€” #${i+1}`;
      lb.appendChild(li);
    });
  }
  function clearScores(){
    if(!level){ alert("Ø§Ø®ØªØ± Ù…Ø³ØªÙˆÙ‰ Ø£ÙˆÙ„Ø§Ù‹ Ø«Ù… Ø§Ù…Ø³Ø­ Ù†ØªØ§Ø¦Ø¬Ù‡."); return; }
    try{ localStorage.removeItem(key()); }catch(e){}
    renderLeaderboard();
  }

  // ========= Confetti =========
  function confettiBurst(){
    const c=$("confetti");
    c.style.display="block";
    const ctx=c.getContext("2d");
    function resize(){ c.width=window.innerWidth; c.height=window.innerHeight; }
    resize();
    const colors=["#fbbf24","#22c55e","#60a5fa","#f472b6","#a78bfa","#34d399"];
    const pieces=[];
    for(let i=0;i<140;i++) pieces.push({
      x:Math.random()*c.width,y:-20-Math.random()*c.height*0.3,
      vx:(Math.random()*2-1)*2.4,vy:2+Math.random()*4,
      r:2+Math.random()*5,a:Math.random()*Math.PI*2,va:(Math.random()*2-1)*0.2,
      col:colors[i%colors.length]
    });
    let t=0;
    const id=setInterval(()=>{
      t++;
      ctx.clearRect(0,0,c.width,c.height);
      pieces.forEach(p=>{
        p.x+=p.vx; p.y+=p.vy; p.a+=p.va; p.vy+=0.03;
        ctx.save();
        ctx.translate(p.x,p.y);
        ctx.rotate(p.a);
        ctx.fillStyle=p.col;
        ctx.fillRect(-p.r,-p.r,p.r*2,p.r*2);
        ctx.restore();
      });
      if(t>140){ clearInterval(id); c.style.display="none"; }
    },16);
  }

  // ========= Wire UI (no inline onclick to maximize compatibility) =========
  $("btnEasy").addEventListener("click", ()=>{ level="easy"; buildRound(); show("screenQuiz"); loadQuestion(); renderLeaderboard(); });
  $("btnMed").addEventListener("click", ()=>{ level="medium"; buildRound(); show("screenQuiz"); loadQuestion(); renderLeaderboard(); });
  $("btnHard").addEventListener("click", ()=>{ level="hard"; buildRound(); show("screenQuiz"); loadQuestion(); renderLeaderboard(); });

  $("btnSkip").addEventListener("click", ()=>{ if(locked) return; locked=true; stopTimer(); $("note").textContent="â­ï¸ ØªÙ… Ø§Ù„ØªØ®Ø·ÙŠ. Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©: " + round[idx].a; setTimeout(next, 900); });
  $("btnRestart").addEventListener("click", ()=>{ if(!level) return; buildRound(); loadQuestion(); });

  $("btnNewQ").addEventListener("click", ()=>{ if(!level) return; buildRound(); show("screenQuiz"); loadQuestion(); });
  $("btnBack").addEventListener("click", ()=>{ stopTimer(); stopMusic(); show("screenLevel"); updatePills(); });

  $("btnClearScores").addEventListener("click", clearScores);
  $("btnTest").addEventListener("click", testSounds);
  $("btnMusic").addEventListener("click", toggleMusic);
  $("musicVol").addEventListener("input", ()=>{ if(musicGain) musicGain.gain.value=parseFloat($("musicVol").value); });

  renderLeaderboard();
  updatePills();
})();
</script>
</body>
</html>